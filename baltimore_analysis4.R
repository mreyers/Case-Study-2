acf_weights_SE_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_SE_2016,
                                        low = acf_weights_low_SE_2016,
                                        medium = acf_weights_medium_SE_2016,
                                        high = acf_weights_high_SE_2016,
                                        very_high = acf_weights_veryhigh_SE_2016
))

acf_weights_SE_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_SE_2015,
                                        low = acf_weights_low_SE_2015,
                                        medium = acf_weights_medium_SE_2015,
                                        high = acf_weights_high_SE_2015,
                                        very_high = acf_weights_veryhigh_SE_2015
))

acf_weights_CD_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_CD_2016,
                                         low = acf_weights_low_CD_2016,
                                         medium = acf_weights_medium_CD_2016,
                                         high = acf_weights_high_CD_2016,
                                         very_high = acf_weights_veryhigh_CD_2016
))

acf_weights_CD_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_CD_2015,
                                         low = acf_weights_low_CD_2015,
                                         medium = acf_weights_medium_CD_2015,
                                         high = acf_weights_high_CD_2015,
                                         very_high = acf_weights_veryhigh_CD_2015
))

acf_weights_CW_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_CW_2016,
                                         low = acf_weights_low_CW_2016,
                                         medium = acf_weights_medium_CW_2016,
                                         high = acf_weights_high_CW_2016,
                                         very_high = acf_weights_veryhigh_CW_2016
))

acf_weights_CW_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_CW_2015,
                                         low = acf_weights_low_CW_2015,
                                         medium = acf_weights_medium_CW_2015,
                                         high = acf_weights_high_CW_2015,
                                         very_high = acf_weights_veryhigh_CW_2015
))

acf_weights_ED_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_ED_2016,
                                         low = acf_weights_low_ED_2016,
                                         medium = acf_weights_medium_ED_2016,
                                         high = acf_weights_high_ED_2016,
                                         very_high = acf_weights_veryhigh_ED_2016
))

acf_weights_ED_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_ED_2015,
                                         low = acf_weights_low_ED_2015,
                                         medium = acf_weights_medium_ED_2015,
                                         high = acf_weights_high_ED_2015,
                                         very_high = acf_weights_veryhigh_ED_2015
))

acf_weights_ND_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_ND_2016,
                                         low = acf_weights_low_ND_2016,
                                         medium = acf_weights_medium_ND_2016,
                                         high = acf_weights_high_ND_2016,
                                         very_high = acf_weights_veryhigh_ND_2016
))

acf_weights_ND_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_ND_2015,
                                         low = acf_weights_low_ND_2015,
                                         medium = acf_weights_medium_ND_2015,
                                         high = acf_weights_high_ND_2015,
                                         very_high = acf_weights_veryhigh_ND_2015
))

acf_weights_NE_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_NE_2016,
                                         low = acf_weights_low_NE_2016,
                                         medium = acf_weights_medium_NE_2016,
                                         high = acf_weights_high_NE_2016,
                                         very_high = acf_weights_veryhigh_NE_2016
))

acf_weights_NE_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_NE_2015,
                                         low = acf_weights_low_NE_2015,
                                         medium = acf_weights_medium_NE_2015,
                                         high = acf_weights_high_NE_2015,
                                         very_high = acf_weights_veryhigh_NE_2015
))

acf_weights_NW_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_NW_2016,
                                         low = acf_weights_low_NW_2016,
                                         medium = acf_weights_medium_NW_2016,
                                         high = acf_weights_high_NW_2016,
                                         very_high = acf_weights_veryhigh_NW_2016
))

acf_weights_NW_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_NW_2015,
                                         low = acf_weights_low_NW_2015,
                                         medium = acf_weights_medium_NW_2015,
                                         high = acf_weights_high_NW_2015,
                                         very_high = acf_weights_veryhigh_NW_2015
))

acf_weights_SD_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_SD_2016,
                                         low = acf_weights_low_SD_2016,
                                         medium = acf_weights_medium_SD_2016,
                                         high = acf_weights_high_SD_2016,
                                         very_high = acf_weights_veryhigh_SD_2016
))

acf_weights_SD_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_SD_2015,
                                         low = acf_weights_low_SD_2015,
                                         medium = acf_weights_medium_SD_2015,
                                         high = acf_weights_high_SD_2015,
                                         very_high = acf_weights_veryhigh_SD_2015
))

acf_weights_SS_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_SS_2016,
                                         low = acf_weights_low_SS_2016,
                                         medium = acf_weights_medium_SS_2016,
                                         high = acf_weights_high_SS_2016,
                                         very_high = acf_weights_veryhigh_SS_2016
))

acf_weights_SS_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_SS_2015,
                                         low = acf_weights_low_SS_2015,
                                         medium = acf_weights_medium_SS_2015,
                                         high = acf_weights_high_SS_2015,
                                         very_high = acf_weights_veryhigh_SS_2015
))

acf_weights_SW_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_SW_2016,
                                         low = acf_weights_low_SW_2016,
                                         medium = acf_weights_medium_SW_2016,
                                         high = acf_weights_high_SW_2016,
                                         very_high = acf_weights_veryhigh_SW_2016
))

acf_weights_SW_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_SW_2015,
                                         low = acf_weights_low_SW_2015,
                                         medium = acf_weights_medium_SW_2015,
                                         high = acf_weights_high_SW_2015,
                                         very_high = acf_weights_veryhigh_SW_2015
))


acf_weights_WD_2016i <- data.frame(cbind(ne = acf_weights_nonemergency_WD_2016,
                                         low = acf_weights_low_WD_2016,
                                         medium = acf_weights_medium_WD_2016,
                                         high = acf_weights_high_WD_2016,
                                         very_high = acf_weights_veryhigh_WD_2016
))

acf_weights_WD_2015i <- data.frame(cbind(ne = acf_weights_nonemergency_WD_2015,
                                         low = acf_weights_low_WD_2015,
                                         medium = acf_weights_medium_WD_2015,
                                         high = acf_weights_high_WD_2015,
                                         very_high = acf_weights_veryhigh_WD_2015
))

stand_func <- function(x) {
  sum_col <- sum(abs(x[-1]))
  x = x/sum_col
  return(x)
}

acf_weights_CD_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_CD_2015i, stand_func)))

acf_weights_CD_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_CD_2016i, stand_func)))

acf_weights_CW_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_CW_2015i, stand_func)))

acf_weights_CW_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_CW_2016i, stand_func)))

acf_weights_ED_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_ED_2015i, stand_func)))

acf_weights_ED_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_ED_2016i, stand_func)))

acf_weights_ND_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_ND_2015i, stand_func)))

acf_weights_ND_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_ND_2016i, stand_func)))

acf_weights_NE_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_NE_2015i, stand_func)))

acf_weights_NE_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_NE_2016i, stand_func)))

acf_weights_NW_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_NW_2015i, stand_func)))

acf_weights_NW_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_NW_2016i, stand_func)))

acf_weights_SD_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_SD_2015i, stand_func)))

acf_weights_SD_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_SD_2016i, stand_func)))

acf_weights_SE_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_SE_2015i, stand_func)))

acf_weights_SE_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_SE_2016i, stand_func)))

acf_weights_SS_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_SS_2015i, stand_func)))

acf_weights_SS_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_SS_2016i, stand_func)))

acf_weights_SW_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_SW_2015i, stand_func)))

acf_weights_SW_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_SW_2016i, stand_func)))

acf_weights_WD_2015 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_WD_2015i, stand_func)))

acf_weights_WD_2016 <- as.data.frame(do.call(cbind, 
                                             map(acf_weights_WD_2016i, stand_func)))



CD_12_2015$y*c(acf_weights_high_CD_2015)



n0 <- WD_25_2016$y
n_0_WD

n1 <- WD_24_2016$y*acf_weights_WD_2016[2,]

error_n <- mean((n1-n0)^2)

n2 <- WD_23_2016$y*acf_weights_WD_2016[3,]
n1_n2 <- n1+n2

error_n2 <- mean((n1_n2 - n0)^2)

n1_n14 <- n1 + WD_11_2016$y*acf_weights_WD_2016[12,]

error_n2 <- mean((n1_n14 - n0)^2)


for (i in 1:13) {
  assign(paste("n", i), WD_24_2016$y*acf_weights_WD_2016[i + 1,])
}

n1 <- WD_24_2016$y*acf_weights_WD_2016[2,]
n2 <- WD_23_2016$y*acf_weights_WD_2016[3,]
n3 <- WD_22_2016$y*acf_weights_WD_2016[4,]
n4 <- WD_21_2016$y*acf_weights_WD_2016[5,]
n5 <- WD_20_2016$y*acf_weights_WD_2016[6,]
n6 <- WD_19_2016$y*acf_weights_WD_2016[7,]
n7 <- WD_18_2016$y*acf_weights_WD_2016[8,]
n8 <- WD_17_2016$y*acf_weights_WD_2016[9,]
n9 <- WD_16_2016$y*acf_weights_WD_2016[10,]
n10 <- WD_15_2016$y*acf_weights_WD_2016[11,]
n11 <- WD_14_2016$y*acf_weights_WD_2016[12,]
n12 <- WD_13_2016$y*acf_weights_WD_2016[13,]
n13 <- WD_12_2016$y*acf_weights_WD_2016[14,]

l1 <- n1
l2 <- n1 + n2
l3 <- n1 + n2 + n3
l4 <- n1 + n2 + n3 + n4
l5 <- n1 + n2 + n3 + n4 + n5
l6 <- n1 + n2 + n3 + n4 + n5 + n6
l7 <- n1 + n2 + n3 + n4 + n5 + n6 + n7
l8 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8
l9 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8 + n9
l10 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8 + n9 + n10
l11 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8 + n9 + n10 + n11
l12 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8 + n9 + n10 + n11 + n12
l13 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8 + n9 + n10 + n11 + n12 + n13

eval(parse(text = paste("l", 1, sep = "")))


errors <- NULL

for (i in 1:13) {
  errors[i] <- mean((eval(parse(text = paste("l", i, sep = ""))) - n0)^2)
}

dist_names <- c("CD", "CW", "ED", "ND", "NE", "NW", "SD",
                "SE", "SW", "WD")

weeks <- as.character(seq(24, 12, -1))

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("CD", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "WD", 2016, sep = "_")))[i + 1,])
}

for (i in 1:length(dist_names)){
  assign(paste("n", 0, dist_names[i], sep = "_"), 
         eval(parse(text = paste(dist_names[i], 25, 2016, sep = "_")))$y)
}

error_calculator <- function(a){
  
  n1 <- m_1*n_1
  n2 <- m_2*n_2
  n3 <- m_3*n_3
  n4 <- m_4*n_4
  n5 <- m_5*n_5
  n6 <- m_6*n_6
  n7 <- m_7*n_7
  n8 <- m_8*n_8
  n9 <- m_9*n_9
  n10 <- m_10*n_10
  n11 <- m_11*n_11
  n12 <- m_12*n_12
  n13 <- m_13*n_13
  
  l1 <- n1
  l2 <- n1 + n2
  l3 <- n1 + n2 + n3
  l4 <- n1 + n2 + n3 + n4
  l5 <- n1 + n2 + n3 + n4 + n5
  l6 <- n1 + n2 + n3 + n4 + n5 + n6
  l7 <- n1 + n2 + n3 + n4 + n5 + n6 + n7
  l8 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8
  l9 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8 + n9
  l10 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8 + n9 + n10
  l11 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8 + n9 + n10 + n11
  l12 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8 + n9 + n10 + n11 + n12
  l13 <- n1 + n2 + n3 + n4 + n5 + n6 + n7 + n8 + n9 + n10 + n11 + n12 + n13
  
  for (i in 1:13) {
    errors[i] <- mean((eval(parse(text = paste("l", i, sep = ""))) - a)^2)
  }
  
  error_df <- data.frame(lag = 1:13, error = errors)
  
  return(error_df)
}

#### CD Errors #####

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("CD", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "CD", 2016, sep = "_")))[i + 1,])
}

CD_errors <- error_calculator(n_0_CD)

ggplot(CD_errors, aes(x = CD_errors$lag, y = CD_errors$error)) +
  geom_point(color = "Forest Green") + 
  geom_point(aes(x = which.min(CD_errors$error), 
                 y = min(CD_errors$e)), color = "Red") +
  geom_line(color = "Light Blue") +
  xlab("Number of Weeks Previous to Current") +
  ylab("Prediction Errors") +
  ggtitle("Optimal Error Rate Plot for District: CD") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) + 
  ggsave("CD_Error_Plot.png")

plott <- ggplot(WD_errors, aes(x = WD_errors$lag, y = WD_errors$error)) +
  geom_point(color = "Forest Green") + 
  geom_point(aes(x = which.min(WD_errors$error), 
                 y = min(WD_errors$e)), color = "Red") +
  geom_line(color = "Light Blue") +
  xlab("Number of Weeks Previous to Current") +
  ylab("Prediction Errors") +
  ggtitle("Optimal Error Rate Plot for District: WD") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

plott
#### CW Errors #####

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("CW", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "CW", 2016, sep = "_")))[i + 1,])
}

CW_errors <- error_calculator(n_0_CW)

ggplot(CW_errors, aes(x = CW_errors$lag, y = CW_errors$error)) +
  geom_point()

#### ED Errors #####

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("ED", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "ED", 2016, sep = "_")))[i + 1,])
}

ED_errors <- error_calculator(n_0_ED)

ggplot(ED_errors, aes(x = ED_errors$lag, y = ED_errors$error)) +
  geom_point()

#### ND Errors #####

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("ND", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "ND", 2016, sep = "_")))[i + 1,])
}

ND_errors <- error_calculator(n_0_ND)

ggplot(ND_errors, aes(x = ND_errors$lag, y = ND_errors$error)) +
  geom_point()

#### NE Errors #####

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("NE", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "NE", 2016, sep = "_")))[i + 1,])
}

NE_errors <- error_calculator(n_0_NE)

ggplot(NE_errors, aes(x = NE_errors$lag, y = NE_errors$error)) +
  geom_point()

#### NW Errors #####

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("NW", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "NW", 2016, sep = "_")))[i + 1,])
}

NW_errors <- error_calculator(n_0_NW)

ggplot(NW_errors, aes(x = NW_errors$lag, y = NW_errors$error)) +
  geom_point()

#### SD Errors #####

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("SD", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "SD", 2016, sep = "_")))[i + 1,])
}

SD_errors <- error_calculator(n_0_SD)

ggplot(SD_errors, aes(x = SD_errors$lag, y = SD_errors$error)) +
  geom_point()

#### SE Errors #####

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("SE", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "SE", 2016, sep = "_")))[i + 1,])
}

SE_errors <- error_calculator(n_0_SE)

ggplot(SE_errors, aes(x = SE_errors$lag, y = SE_errors$error)) +
  geom_point()

#### SW Errors #####

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("SW", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "SW", 2016, sep = "_")))[i + 1,])
}

SW_errors <- error_calculator(n_0_SW)

ggplot(SW_errors, aes(x = SW_errors$lag, y = SW_errors$error)) +
  geom_point()

#### WD Errors #####

for (i in 1:13){
  assign(paste("m", i, sep = "_"), eval(parse(text = paste("WD", weeks[i], 2016, sep = "_")))$y)
}

for (i in 1:13){
  assign(paste("n", i, sep = "_"), 
         eval(parse(text = paste("acf_weights", "WD", 2016, sep = "_")))[i + 1,])
}

WD_errors <- error_calculator(n_0_WD)

ggplot(WD_errors, aes(x = WD_errors$lag, y = WD_errors$error)) +
  geom_point()














########################################################

testWD_low <- baltimore_edit %>% 
  filter(District == "WD" & Year == 2015 & Priority == "Medium") 

testWD_low<- testWD_low[-(27:53),]

testWD_low <- testWD_low[seq(dim(testWD_low)[1],1),] 

acf(testWD_low$Proportion)
